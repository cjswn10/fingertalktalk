<!DOCTYPE html>
<html>
<head>
    <title>Hello WebSocket</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/sockjs/1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script type="text/javascript" >



        var chatSock = null;

        var message = {};



        $(document).ready(function(){



            chatSock = new SockJS("/gs-guide-websocket");



            chatSock.onopen = function() {



                message={};

                message.message = "반갑습니다.";

                message.type = "all";

                message.to = "all";

                chatSock.send(JSON.stringify(message));

            };



            chatSock.onmessage = function(evt) {

                $("#chatMessage").append(evt.data);

                $("#chatMessage").append("<br />");

                $("#chatMessage").scrollTop(99999999);

            };



            chatSock.onclose = function() {

                // sock.send("채팅을 종료합니다.");

            }



            $("#message").keydown(function (key) {

                if (key.keyCode == 13) {

                    $("#sendMessage").click();

                }

            });



            $("#sendMessage").click(function() {

                if( $("#message").val() != "") {



                    message={};

                    message.message = $("#message").val();

                    message.type = "all";

                    message.to = "all";



                    var to = $("#to").val();

                    if ( to != "") {

                        message.type = "one";

                        message.to = to;

                    }



                    chatSock.send(JSON.stringify(message));

                    $("#chatMessage").append("나 ->  " + $("#message").val() + "<br/>");

                    $("#chatMessage").scrollTop(99999999);



                    $("#message").val("");

                }

            });

        });

    </script>

</head>

<body>

<input type="button" id="sendMessage" value="엔터" />

<input type="text" id="message" placeholder="메시지 내용"/>

<input type="text" id="to" placeholder="귓속말대상"/>

<div id="chatMessage" style="overFlow: auto; max-height: 500px;"></div>

</body>

</html>
